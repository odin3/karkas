/**
  * Karkas.JS 
  * @author Denis Sedchenko (https://github.com/odin3/karkas)
  * @version 2.4.1
  */
var karkas={version:"2.4.1",views:[],filter:function(filterQuery,value){filterQuery=filterQuery.trim().split(":");var filterName=filterQuery[0];value=[value];if(filterQuery.length>1){var filterArgs=eval("["+filterQuery[1].trim()+"]");value=value.concat(filterArgs)}try{var filter=karkas.filters.get(filterName);return filter.apply(filter,value)}catch(ex){throw new Error("Karkas: failed to apply filter '"+filterName+"', reason: "+ex.message)}},filters:{__container__:{currency:function(c,e){e=e||"$";var d=c%1,a=parseInt(c);var b=a+".";b+=(d<0.1)?"0"+parseInt(d*100):String((d*100));return e+" "+b},string:function(b,d){try{var c=[].splice.apply(arguments,[2]);return""[d].apply(b,c)}catch(a){throw new Error("Failed to perform method `String."+d+"` ("+a.message+")")}},math:function(b,c){try{[].splice.apply(arguments,[1,1]);return Math[c].apply(Math,arguments)}catch(a){throw new Error("Failed to perform method `Math."+c+"` ("+a.message+")")}},json:function(b){try{return JSON.stringify(b)}catch(a){return b}},toUpper:function(a){return String(a).toUpperCase()},toLower:function(a){return String(a).toLowerCase()},capitalize:function(a){a=String(a);return a.substring(0,1).toUpperCase()+a.substring(1)}},get:function(a){if(typeof this.__container__[a]=="undefined"){throw new ReferenceError("Karkas: undefined filter or template: '"+a+"'")}return this.__container__[a]},add:function(a,b){this.__container__[a]=b}},params:{autorun:true,parseAsObject:false,replaceUndefinedExpressions:true,},findAll:function(){this.views=[];var a=document.querySelectorAll("script[type='template/karkas']");for(var b=0;b<a.length;b++){this.views[a[b].getAttribute("name")]=new KarkasView(a[b])}},compile:function(a,f,g,c){var b="",e=this.getView(a);g=g||false;c=c||false;b=e[(f instanceof Array)?"parseArray":"parse"](f);if(g==false){return b}if((typeof jQuery!="undefined")&&g instanceof jQuery){if(g.length>0){g=g.get(0)}else{return b}}function h(i){if(c){i.innerHTML=b}else{i.innerHTML+=b}return b}if(g instanceof HTMLElement){return h(g)}if(typeof g=="string"){g=document.querySelectorAll(g)}for(var d=0;d<g.length;d++){h(g[d])}return b},include:function(a){if(document.querySelectorAll("karkas").length==0){document.getElementsByTagName("body")[0].appendChild(document.createElement("karkas"))}return new Promise(function(c,b){var d=new XMLHttpRequest();d.open("GET",a);d.onload=function(){if(this.status>=200&&this.status<300){document.querySelector("karkas").innerHTML+=d.response;karkas.findAll();c(d.response)}else{b({status:this.status,statusText:d.statusText})}};d.onerror=function(){b({status:this.status,statusText:d.statusText})};d.send()})},getView:function(a){if(typeof karkas.views[a]=="undefined"){throw new ReferenceError("KarkasJS: Requested template is not defined: '"+a+"'")}return karkas.views[a]}};var KarkasView=function(a){if(a.getAttribute("name")==null||a.getAttribute("name").length==0){throw new ReferenceError("KarkasJS: Template element must have a name")}else{this.name=a.getAttribute("name")||"";this.element=a;this.selector=this.element.tagName.toLowerCase()+"[name='"+this.name+"']"}};KarkasView.prototype={pattern:/[{{](\S*)[}}]+/gim,getContext:function(){return this.element.innerHTML},parse:function(fields){var sReturn=this.getContext(),tpFields=sReturn.match(this.pattern);function isset(e){return typeof e!="undefined"}for(var pat in tpFields){if(typeof tpFields[pat]=="string"||typeof tpFields[pat]=="number"){var key=tpFields[pat].replace("{{","").replace("}}","").trim().split("|");var filter=(key.length>1)?key[key.length-1]:undefined;key=key[0];var newVal;try{newVal=(key=="this")?fields:eval((karkas.params.parseAsObject)?"fields."+key:'fields["'+key.split(".").join('"]["')+'"]')}catch(ex){throw new ReferenceError("Karkas: failed to parse expression '"+key+"' in template '"+this.name+"'. "+ex.message)}if((!isset(newVal))&&(karkas.params.replaceUndefinedExpressions)){newVal=""}if(isset(filter)){newVal=karkas[(isset(karkas.views[filter]))?"compile":"filter"](filter,newVal)}sReturn=sReturn.replace(tpFields[pat],newVal)}}return sReturn},parseArray:function(a){var d="";for(var b=0;b<a.length;b++){d+=this.parse(a[b])}return d}};(function(){document.createElement("karkas");var b="karkas{display: none;}",a=document.head||document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css";c.styleSheet?c.styleSheet.cssText=b:c.appendChild(document.createTextNode(b));a.appendChild(c);if(karkas.params.autorun){karkas.findAll()}})();