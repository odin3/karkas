/**
  * KarkasJS 
  * @author Denis Sedchenko (https://github.com/odin3/karkasJS)
  * @version 2.1
  */
var karkas={views:[],version:"2.1",findAll:function(){this.views=[];if(document.querySelectorAll("template").length>0){console.warn("KarkasJS: HTML element `template` is deprecated, use `script[type='template/karkas']` instead.")}var a=document.querySelectorAll("template, script[type='template/karkas']");for(var b=0;b<a.length;b++){this.views[a[b].getAttribute("name")]=new karkasView(a[b])}},compile:function(a,f,g,c){var b="",e=this.getView(a);g=g||false;c=c||false;if(f instanceof Array){b=e.parseArray(f)}else{b=e.parse(f)}if(g==false){return b}if((typeof jQuery!=="undefined")&&g instanceof jQuery&&g.length>0){g=g.get(0)}else{return b}function h(i){if(c){i.innerHTML=b}else{i.innerHTML+=b}return b}if(g instanceof HTMLElement){return h(g)}if(typeof g=="string"){g=document.querySelectorAll(g)}for(var d=0;d<g.length;d++){h(g[d])}return b},include:function(a){if(document.querySelectorAll("karkas").length==0){document.getElementsByTagName("body")[0].appendChild(document.createElement("karkas"))}return new Promise(function(c,b){var d=new XMLHttpRequest();d.open("GET",a);d.onload=function(){if(this.status>=200&&this.status<300){document.querySelector("karkas").innerHTML+=d.response;karkas.findAll();c(d.response)}else{b({status:this.status,statusText:d.statusText})}};d.onerror=function(){b({status:this.status,statusText:d.statusText})};d.send()})},getView:function(a){if(typeof karkas.views[a]=="undefined"){throw new ReferenceError("[KarkasView] Requested template is not defined: '"+a+"'")}return karkas.views[a]}};var karkasView=function(a){this.name=a.getAttribute("name")||"";this.selector="template[name='"+this.name+"']";this.element=a};karkasView.prototype={pattern:/[{{](\S*)[}}]+/gim,getContext:function(){return this.element.innerHTML},parse:function(a){var f=this.getContext(),e=f.match(this.pattern);for(var c in e){if(typeof e[c]=="string"||typeof e[c]=="number"){var d=e[c].replace("{{","").replace("}}","");var b="";if(d=="this"&&typeof a!="object"){b=a}else{if(typeof a[d]!="undefined"){b=a[d.toString()].toString()}}f=f.replace(e[c],b)}}return f},parseArray:function(a){var d="";for(var b=0;b<a.length;b++){d+=this.parse(a[b])}return d}};(function(){document.createElement("template");document.createElement("karkas");var b="template,karkas{display: none;}",a=document.head||document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css";c.styleSheet?c.styleSheet.cssText=b:c.appendChild(document.createTextNode(b));a.appendChild(c);karkas.findAll()})();
