/**
  * KarkasJS 
  * @author Denis Sedchenko (https://github.com/odin3/karkasJS)
  * @version 2.1.6
  */
var karkas={views:[],version:"2.1.6",autorun:!0,params:{parseAsObject:!1,allowTemplatesTag:!1},findAll:function(){this.views=[];var b="script[type='template/karkas']";this.params.allowTemplatesTag&&(b+=" ,template");for(var b=document.querySelectorAll(b),c=0;c<b.length;c++)this.views[b[c].getAttribute("name")]=new karkasView(b[c])},compile:function(b,c,a,d){function f(a){a.innerHTML=d?e:a.innerHTML+e;return e}var e="";b=this.getView(b);a=a||!1;d=d||!1;e=c instanceof Array?b.parseArray(c):b.parse(c);
if(0==a)return e;if("undefined"!==typeof jQuery&&a instanceof jQuery)if(0<a.length)a=a.get(0);else return e;if(a instanceof HTMLElement)return f(a);"string"==typeof a&&(a=document.querySelectorAll(a));for(c=0;c<a.length;c++)f(a[c]);return e},include:function(b){0==document.querySelectorAll("karkas").length&&document.getElementsByTagName("body")[0].appendChild(document.createElement("karkas"));return new Promise(function(c,a){var d=new XMLHttpRequest;d.open("GET",b);d.onload=function(){200<=this.status&&
300>this.status?(document.querySelector("karkas").innerHTML+=d.response,karkas.findAll(),c(d.response)):a({status:this.status,statusText:d.statusText})};d.onerror=function(){a({status:this.status,statusText:d.statusText})};d.send()})},getView:function(b){if("undefined"==typeof karkas.views[b])throw new ReferenceError("KarkasJS: Requested template is not defined: '"+b+"'");return karkas.views[b]}},karkasView=function(b){if(null==b.getAttribute("name")||0==b.getAttribute("name").length)throw new ReferenceError("KarkasJS: Template element must have a name");
this.name=b.getAttribute("name")||"";this.element=b;this.selector=this.element.tagName.toLowerCase()+"[name='"+this.name+"']"};
karkasView.prototype={pattern:/[{{](\S*)[}}]+/gim,getContext:function(){return this.element.innerHTML},parse:function(b){var c=this.getContext(),a=c.match(this.pattern),d;for(d in a)if("string"==typeof a[d]||"number"==typeof a[d])var f=a[d].replace("{{","").replace("}}",""),e="",e="this"==f&&"object"!=typeof b?b:eval(karkas.params.parseAsObject?"fields."+f:'fields["'+f.split(".").join('"]["')+'"]'),c=c.replace(a[d],e);return c},parseArray:function(b){for(var c="",a=0;a<b.length;a++)c+=this.parse(b[a]);
return c}};(function(){document.createElement("template");document.createElement("karkas");var b=1==karkas.params.allowTemplatesTag?"template,karkas{display: none;}":"karkas{display: none;}",c=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css";a.styleSheet?a.styleSheet.cssText=b:a.appendChild(document.createTextNode(b));c.appendChild(a);karkas.autorun&&karkas.findAll()})();
