/**
  * Karkas.JS 
  * @author Denis Sedchenko (https://github.com/odin3/karkas)
  * @version 2.4.7
  */
!function(a,b){function c(a){return"undefined"!=typeof a}function e(a){return null==a}var d={version:"2.4.7",views:{},params:{autorun:!0,useTemplateCache:!0,removeTemplatesFromDom:!1,replaceUndefinedExpressions:!0,templateSourceSelector:"script[type='template/karkas']"},log:function(b,d){return d=d||"log",b="Karkas: "+b,c(a.console)&&c(a.console[d])?a.console[d](b):null},filter:function(a,b){a=a.trim().split(":");var c=a[0];if(b=[b],a.length>1){var e=new Function("return ["+a[1].trim()+"]")();b=b.concat(e)}try{var f=d.filters.get(c);return f.apply(f,b)}catch(g){throw new Error("Karkas: failed to apply filter '"+c+"', reason: "+g.message)}},filters:{__container__:{currency:function(a,b,c){function d(a,b,c,d){var b=isNaN(b=Math.abs(b))?2:b,c=void 0==c?".":c,d=void 0==d?",":d,e=0>a?"-":"",f=parseInt(a=Math.abs(+a||0).toFixed(b))+"",g=(g=f.length)>3?g%3:0;return e+(g?f.substr(0,g)+d:"")+f.substr(g).replace(/(\d{3})(?=\d)/g,"$1"+d)+(b?c+Math.abs(a-f).toFixed(b).slice(2):"")}return b=b||"$",b+" "+d(a,c)},string:function(a,b){try{var c=[].splice.apply(arguments,[2]);return""[b].apply(a,c)}catch(d){throw new Error("Failed to perform method `String."+b+"` ("+d.message+")")}},math:function(a,b){try{return[].splice.apply(arguments,[1,1]),Math[b].apply(Math,arguments)}catch(c){throw new Error("Failed to perform method `Math."+b+"` ("+c.message+")")}},array:function(a,b){try{var c=[].splice.apply(arguments,[2]);return[][b].apply(a,c)}catch(d){throw new Error("Failed to perform method `Array."+b+"` ("+d.message+")")}},json:function(a){try{return JSON.stringify(a)}catch(b){return a}},toUpper:function(a){return String(a).toUpperCase()},toLower:function(a){return String(a).toLowerCase()},capitalize:function(a){return a=String(a),a.substring(0,1).toUpperCase()+a.substring(1)}},get:function(a){if("undefined"==typeof this.__container__[a])throw new ReferenceError("Karkas: undefined filter or template: '"+a+"'");return this.__container__[a]},add:function(a,b){this.__container__[a]=b}},clear:function(){for(var a in this.views)delete this.views[a]},onFind:function(){},refresh:function(a){a&&this.clear();var c=String(this.params.templateSourceSelector);a||(c+=":not([data-loaded])");for(var f=b.querySelectorAll(c),g=0;g<f.length;g++)this.views[f[g].getAttribute("name")]=new d.View(f[g]);var h=b.querySelector("*["+this.params.elementsSelector+"]");if(e(h))return!0;for(var i=0;i<h.length;i++)this.applyToElement(h[i]);"function"==typeof this.onFind&&this.onFind()},findAll:function(a){return this.refresh(a)},exists:function(a){return c(this.views[a])},compile:function(a,c,d,e){function h(a){return e?a.innerHTML=f:a.innerHTML+=f,f}var f="",g=this.getView(a);if(c=c||{},d=d||!1,e=e||!1,f=g[c instanceof Array?"parseArray":"parse"](c),0==d)return f;if("undefined"!=typeof jQuery&&d instanceof jQuery){if(!(d.length>0))return f;d=d.get(0)}if(d instanceof HTMLElement)return h(d);"string"==typeof d&&(d=b.querySelectorAll(d));for(var i=0;i<d.length;i++)h(d[i]);return f},include:function(a,c){function e(c,e){var f=b.querySelector("body");if(!f)throw new Error("Karkas: body element is required in DOM");var g=new XMLHttpRequest;g.open("GET",a),g.onload=function(){this.status>=200&&this.status<300?(f.innerHTML+=g.response,d.refresh(),c(g.response)):e({status:this.status,statusText:g.statusText})},g.onerror=function(){e({status:this.status,statusText:g.statusText})},g.send()}return"function"==typeof c||"undefined"==typeof window.Promise?e(c):new Promise(function(a,b){e(a,b)})},getView:function(a){if("undefined"==typeof d.views[a])throw new ReferenceError("KarkasJS: Requested template is not defined: '"+a+"'");return d.views[a]}};d.View=function(a,b){function i(a,b){return new Function("with(this) { return "+b+"; }").apply(a)}if(!c(a))throw new ReferenceError("KarkasJS: karkas.View: viewElement is not defined.");if(this.hasElement=a instanceof HTMLElement,!this.hasElement&&"string"!=typeof a)throw new TypeError("KarkasJS: View content can be only HTMLElement or String");if(this.hasElement&&!c(b)){if(null==a.getAttribute("name")||0==a.getAttribute("name").length)throw new ReferenceError("KarkasJS: Template element must have a name");b=a.getAttribute("name")}this.pattern=/[\{\{](.*?)[\}\}]+/gim,this.name=b,this.element=d.params.removeTemplatesFromDom||!this.hasElement?null:a;var e=null,f=this,g=d.params.removeTemplatesFromDom,h=d.params.useTemplateCache;this.hasElement?(e=d.params.useTemplateCache?a.innerHTML.trim():null,g?a.remove():this.element.setAttribute("data-loaded","true")):e=a,this.getContext=function(){return null==this.element||g&&h?e:h&&null!==e?e:this.element.innerHTML},this.apply=function(a){return a=a||!1,d.exists(this.name)&&!a?(d.log('Cannot apply new template, "'+this.name+'" already exists. Use "apply(true)" to overwrite it.',"warn"),!1):(d.views[f.name]=this,!0)},this.parse=function(a){function e(a){return"undefined"!=typeof a}var b=this.getContext(),c=b.match(this.pattern);for(var f in c)if("string"==typeof c[f]||"number"==typeof c[f]){var g=c[f].replace("{{","").replace("}}","").trim().split("|"),h=g.length>1?g[g.length-1]:void 0;g=g[0];var j;try{j=i(a,g)}catch(k){throw new ReferenceError("Karkas: failed to parse expression '"+g+"' in template '"+this.name+"'. "+k.message)}!e(j)&&d.params.replaceUndefinedExpressions&&(j=""),e(h)&&(j=d[e(d.views[h])?"compile":"filter"](h,j)),b=b.replace(c[f],j)}return b},this.parseArray=function(a){for(var b="",c=0;c<a.length;c++)b+=this.parse(a[c]);return b}},a.karkas=d,b.addEventListener("DOMContentLoaded",function(){d.params.autorun&&d.refresh(!0)})}(window,document);