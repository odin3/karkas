/**
  * KarkasJS 
  * @author Denis Sedchenko (https://github.com/odin3/karkasJS)
  * @version 2.1.5
  */
var karkas={views:[],version:"2.1.5",autorun:true,params:{parseAsObject:false,allowTemplatesTag:false,},findAll:function(){this.views=[];var b="script[type='template/karkas']";if(this.params.allowTemplatesTag){b+=" ,template"}var a=document.querySelectorAll(b);for(var d=0;d<a.length;d++){this.views[a[d].getAttribute("name")]=new karkasView(a[d])}},compile:function(a,f,g,c){var b="",e=this.getView(a);g=g||false;c=c||false;if(f instanceof Array){b=e.parseArray(f)}else{b=e.parse(f)}if(g==false){return b}if((typeof jQuery!=="undefined")&&g instanceof jQuery){if(g.length>0){g=g.get(0)}else{return b}}function h(i){if(c){i.innerHTML=b}else{i.innerHTML+=b}return b}if(g instanceof HTMLElement){return h(g)}if(typeof g=="string"){g=document.querySelectorAll(g)}for(var d=0;d<g.length;d++){h(g[d])}return b},include:function(a){if(document.querySelectorAll("karkas").length==0){document.getElementsByTagName("body")[0].appendChild(document.createElement("karkas"))}return new Promise(function(c,b){var d=new XMLHttpRequest();d.open("GET",a);d.onload=function(){if(this.status>=200&&this.status<300){document.querySelector("karkas").innerHTML+=d.response;karkas.findAll();c(d.response)}else{b({status:this.status,statusText:d.statusText})}};d.onerror=function(){b({status:this.status,statusText:d.statusText})};d.send()})},getView:function(a){if(typeof karkas.views[a]=="undefined"){throw new ReferenceError("KarkasJS: Requested template is not defined: '"+a+"'")}return karkas.views[a]}};var karkasView=function(a){if(a.getAttribute("name")==null||a.getAttribute("name").length==0){throw new ReferenceError("KarkasJS: Template element must have a name")}else{this.name=a.getAttribute("name")||"";this.element=a;this.selector=this.element.tagName.toLowerCase()+"[name='"+this.name+"']"}};karkasView.prototype={pattern:/[{{](\S*)[}}]+/gim,getContext:function(){return this.element.innerHTML},parse:function(fields){var sReturn=this.getContext(),tpFields=sReturn.match(this.pattern);for(var pat in tpFields){if(typeof tpFields[pat]=="string"||typeof tpFields[pat]=="number"){var key=tpFields[pat].replace("{{","").replace("}}","");var newVal="";if(key=="this"&&typeof fields!="object"){newVal=fields}else{newVal=eval((karkas.params.parseAsObject)?"fields."+key:'fields["'+key.split(".").join('"]["')+'"]')}sReturn=sReturn.replace(tpFields[pat],newVal)}}return sReturn},parseArray:function(a){var d="";for(var b=0;b<a.length;b++){d+=this.parse(a[b])}return d}};(function(){document.createElement("template");document.createElement("karkas");var b=(karkas.params.allowTemplatesTag==true)?"template,karkas{display: none;}":"karkas{display: none;}",a=document.head||document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css";c.styleSheet?c.styleSheet.cssText=b:c.appendChild(document.createTextNode(b));a.appendChild(c);if(karkas.autorun){karkas.findAll()}})();
