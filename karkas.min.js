/**
  * Karkas.JS 
  * @author Denis Sedchenko (https://github.com/odin3/karkas)
  * @version 2.4.4
  */
(function(p,h){var f={version:"2.4.4",views:{},params:{autorun:!0,useTemplateCache:!0,removeTemplatesFromDom:!1,replaceUndefinedExpressions:!0,templateSourceSelector:"script[type='template/karkas']",parseAsObject:!1},filter:function(a,b){a=a.trim().split(":");var c=a[0];b=[b];if(1<a.length){var d=eval("["+a[1].trim()+"]");b=b.concat(d)}try{var e=f.filters.get(c);return e.apply(e,b)}catch(g){throw Error("Karkas: failed to apply filter '"+c+"', reason: "+g.message);}},filters:{__container__:{currency:function(a,
b,c){b=(b||"$")+" ";var d,e=void 0,g=void 0;c=isNaN(c=Math.abs(c))?2:c;var e=void 0==e?".":e,g=void 0==g?",":g,f=0>a?"-":"",n=parseInt(a=Math.abs(+a||0).toFixed(c))+"";d=3<(d=n.length)?d%3:0;d=f+(d?n.substr(0,d)+g:"")+n.substr(d).replace(/(\d{3})(?=\d)/g,"$1"+g)+(c?e+Math.abs(a-n).toFixed(c).slice(2):"");return b+d},string:function(a,b){try{var c=[].splice.apply(arguments,[2]);return""[b].apply(a,c)}catch(d){throw Error("Failed to perform method `String."+b+"` ("+d.message+")");}},math:function(a,
b){try{return[].splice.apply(arguments,[1,1]),Math[b].apply(Math,arguments)}catch(c){throw Error("Failed to perform method `Math."+b+"` ("+c.message+")");}},json:function(a){try{return JSON.stringify(a)}catch(b){return a}},toUpper:function(a){return String(a).toUpperCase()},toLower:function(a){return String(a).toLowerCase()},capitalize:function(a){a=String(a);return a.substring(0,1).toUpperCase()+a.substring(1)}},get:function(a){if("undefined"==typeof this.__container__[a])throw new ReferenceError("Karkas: undefined filter or template: '"+
a+"'");return this.__container__[a]},add:function(a,b){this.__container__[a]=b}},clear:function(){for(var a in this.views)delete this.views[a]},onFind:function(){},refresh:function(a){a&&this.clear();var b=String(this.params.templateSourceSelector);a||(b+=":not([data-loaded])");a=h.querySelectorAll(b);for(b=0;b<a.length;b++)this.views[a[b].getAttribute("name")]=new f.View(a[b]);if("function"==typeof this.onFind)this.onFind()},findAll:function(a){return this.refresh(a)},compile:function(a,b,c,d){function e(a){a.innerHTML=
d?g:a.innerHTML+g;return g}var g="";a=this.getView(a);b=b||{};c=c||!1;d=d||!1;g=a[b instanceof Array?"parseArray":"parse"](b);if(0==c)return g;if("undefined"!=typeof jQuery&&c instanceof jQuery)if(0<c.length)c=c.get(0);else return g;if(c instanceof HTMLElement)return e(c);"string"==typeof c&&(c=h.querySelectorAll(c));for(b=0;b<c.length;b++)e(c[b]);return g},include:function(a){return new Promise(function(b,c){var d=h.querySelector("body");if(!d)throw Error("Karkas: body element is required in DOM");
var e=new XMLHttpRequest;e.open("GET",a);e.onload=function(){200<=this.status&&300>this.status?(d.innerHTML+=e.response,f.refresh(),b(e.response)):c({status:this.status,statusText:e.statusText})};e.onerror=function(){c({status:this.status,statusText:e.statusText})};e.send()})},getView:function(a){if("undefined"==typeof f.views[a])throw new ReferenceError("KarkasJS: Requested template is not defined: '"+a+"'");return f.views[a]},View:function(a){function b(a,b){return(new Function("with(this) { return "+
b+"; }")).apply(a)}if(null==a.getAttribute("name")||0==a.getAttribute("name").length)throw new ReferenceError("KarkasJS: Template element must have a name");this.pattern=/[\{\{](.*?)[\}\}]+/gim;this.name=a.getAttribute("name")||"";this.element=f.params.removeTemplatesFromDom?null:a;var c=f.params.useTemplateCache?a.innerHTML.trim():null,d=f.params.removeTemplatesFromDom,e=f.params.useTemplateCache;d?a.remove():this.element.setAttribute("data-loaded","true");this.getContext=function(){return null==
this.element||d&&e?c:e&&null!==c?c:this.element.innerHTML};this.parse=function(a){function c(a){return"undefined"!=typeof a}var d=this.getContext(),e=d.match(this.pattern),m;for(m in e)if("string"==typeof e[m]||"number"==typeof e[m]){var k=e[m].replace("{{","").replace("}}","").trim().split("|"),h=1<k.length?k[k.length-1]:void 0,k=k[0],l;try{l=b(a,k)}catch(q){throw new ReferenceError("Karkas: failed to parse expression '"+k+"' in template '"+this.name+"'. "+q.message);}!c(l)&&f.params.replaceUndefinedExpressions&&
(l="");c(h)&&(l=f[c(f.views[h])?"compile":"filter"](h,l));d=d.replace(e[m],l)}return d};this.parseArray=function(a){for(var b="",c=0;c<a.length;c++)b+=this.parse(a[c]);return b}}};p.karkas=f;h.addEventListener("DOMContentLoaded",function(){f.params.autorun&&f.refresh(!0)})})(window,document);