/**
  * KarkasJS 
  * @author Denis Sedchenko (https://github.com/odin3/karkasJS)
  * @version 2.0.1
  */
var karkas={views:[],version:"2.0.1",findAll:function(){this.views=[];for(var b=document.querySelectorAll("template"),a=0;a<b.length;a++)this.views[b[a].getAttribute("name")]=new karkasView(b[a])},compile:function(b,a,c,d){function f(a){a.innerHTML=d?e:a.innerHTML+e;return e}var e="";b=this.getView(b);c=c||!1;d=d||!1;e=a instanceof Array?b.parseArray(a):b.parse(a);if(0==c)return e;if(c instanceof HTMLElement)return f(c);"string"==typeof c&&(c=document.querySelectorAll(c));for(a=0;a<c.length;a++)f(c[a]);
    return e},include:function(b){0==document.querySelectorAll("karkas").length&&document.getElementsByTagName("body")[0].appendChild(document.createElement("karkas"));return new Promise(function(a,c){var d=new XMLHttpRequest;d.open("GET",b);d.onload=function(){200<=this.status&&300>this.status?(document.querySelector("karkas").innerHTML+=d.response,karkas.findAll(),a(d.response)):c({status:this.status,statusText:d.statusText})};d.onerror=function(){c({status:this.status,statusText:d.statusText})};d.send()})},
    getView:function(b){if("undefined"==typeof karkas.views[b])throw new ReferenceError("[KarkasView] Requested template is not defined: '"+b+"'");return karkas.views[b]}},karkasView=function(b){this.name=b.getAttribute("name")||"";this.selector="template[name='"+this.name+"']";this.element=b};
karkasView.prototype={pattern:/[{{](\S*)[}}]+/gim,getContext:function(){return this.element.innerHTML},parse:function(b){var a=this.getContext(),c=a.match(this.pattern),d;for(d in c)if("string"==typeof c[d]){var f=c[d].replace("{{","").replace("}}",""),e="";"undefined"!=typeof b[f]&&(e=b[f].toString());a=a.replace(c[d],e)}return a},parseArray:function(b){for(var a="",c=0;c<b.length;c++)a+=this.parse(b[c]);return a}};
(function(){document.createElement("template");document.createElement("karkas");var b=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css";a.styleSheet?a.styleSheet.cssText="template,karkas{display: none;}":a.appendChild(document.createTextNode("template,karkas{display: none;}"));b.appendChild(a)})();
